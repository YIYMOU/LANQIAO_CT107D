C51 COMPILER V9.55   MAIN                                                                  11/04/2020 20:31:28 PAGE 1   


C51 COMPILER V9.55, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: F:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <stc15f2k60s2.h>
   2          #include "iic.h"
   3          
   4          #define u8 unsigned char
   5          #define u16 unsigned int
   6          
   7          u8 code TAB[] = {0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90,0xbf,0xff};
   8          u8 disbuf[] = {0,11,11,11,11,10,6,7,8};
   9          
  10          u8 key_buf = 0;
  11          u8 smg_cnt = 0;
  12          
  13          u8 ch = 1; 
  14          
  15          extern u8 TIME[];
  16          
  17          float temperature;
  18          
  19          void Delay5ms()         //@12.000MHz
  20          {
  21   1              unsigned char i, j;
  22   1      
  23   1              i = 59;
  24   1              j = 90;
  25   1              do
  26   1              {
  27   2                      while (--j);
  28   2              } while (--i);
  29   1      }
  30          
  31          void set_port(u8 p2,u8 p0)
  32          {
  33   1              P0 = p0;
  34   1              P2 &= 0X1F;
  35   1              P2 |= p2;       // 不能影响其他位，否则可能会对其他的协议造成影响
  36   1              P0 = p0;
  37   1              P2 &= 0X1F;
  38   1      }
  39          
  40          void allinit(void)
  41          {
  42   1              set_port(0x80,0xff);
  43   1              set_port(0xc0,0xff);
  44   1              set_port(0xe0,0xff);
  45   1              set_port(0xa0,0x00);
  46   1      }
  47          
  48          void BTN(void)
  49          {
  50   1              u8 key_temp ;
  51   1              key_temp = P3 & 0X0F;
  52   1              if(key_temp != 0x0f && !key_buf)
  53   1              {
  54   2                      Delay5ms();
C51 COMPILER V9.55   MAIN                                                                  11/04/2020 20:31:28 PAGE 2   

  55   2                      key_temp = P3 & 0X0F;
  56   2                      if(key_temp != 0x0f && !key_buf)
  57   2                      {       
  58   3                              key_buf = key_temp;
  59   3                      }
  60   2              }
  61   1              else if(key_temp == 0x0f && key_buf)
  62   1              {
  63   2                      Delay5ms();
  64   2                      key_temp = P3 & 0X0F;
  65   2                      if(key_temp == 0x0f && key_buf)
  66   2                      {       
  67   3                              switch(key_buf) // 这里要特别注意是key_buf，不要粗心写成了key_temp
  68   3                              {
  69   4      //                              case 0x0e: disbuf[1] = 7; disbuf[2] = 10; break;
  70   4      //                              case 0x0d: disbuf[1] = 6; disbuf[2] = 10; break;
  71   4                                      case 0x0b: ch = 1; break;
  72   4                                      case 0x07: ch = 3; break;
  73   4                              }
  74   3                              key_buf = 0;
  75   3                      }
  76   2              }
  77   1      }
  78          
  79          void Timer2Init(void)           //1毫秒@12.000MHz
  80          {
  81   1              AUXR |= 0x04;           //定时器时钟1T模式
  82   1              T2L = 0x20;             //设置定时初值
  83   1              T2H = 0xD1;             //设置定时初值
  84   1              AUXR |= 0x10;           //定时器2开始计时
  85   1      }
  86          
  87          void timer2(void) interrupt 12
  88          {
  89   1              set_port(0xc0, 0x01 << smg_cnt);
  90   1              set_port(0xe0, TAB[disbuf[smg_cnt + 1]]);
  91   1              if(++smg_cnt >= 8) smg_cnt = 0;
  92   1      }
  93          
  94          void main()
  95          {
  96   1              u8 temp;
  97   1              allinit();
  98   1              Timer2Init();
  99   1              IE2 |= 0X04;    // 打开定时器2的中断，谨记
 100   1              EA = 1;
 101   1              
 102   1              write_at24c02(0x00,234);        // 向EEROM地址为0x00的位置写入234
 103   1              Delay5ms();
 104   1              write_pcf8591(153);     // DA输出3V
 105   1              Delay5ms();
 106   1              temp = read_at24c02(0x00);      // 将EEROM地址为0x00的数据读出来
 107   1              disbuf[1] = temp / 100;
 108   1              disbuf[2] = temp / 10 % 10;
 109   1              disbuf[3] = temp % 10;
 110   1              disbuf[4] = 11;
 111   1              disbuf[5] = 11;
 112   1              while(1)
 113   1              {
 114   2                      
 115   2                      temp = read_pcf8591(ch);
 116   2                      temp = read_pcf8591(ch);        // 建议读PCF8591的时候，读两次
C51 COMPILER V9.55   MAIN                                                                  11/04/2020 20:31:28 PAGE 3   

 117   2                      disbuf[6] = temp / 100 % 10;
 118   2                      disbuf[7] = temp / 10 % 10;
 119   2                      disbuf[8] = temp % 10;
 120   2                      
 121   2                      BTN();
 122   2              }
 123   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    335    ----
   CONSTANT SIZE    =     12    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     16    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
