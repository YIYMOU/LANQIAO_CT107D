C51 COMPILER V9.55   MAIN                                                                  03/24/2020 10:52:32 PAGE 1   


C51 COMPILER V9.55, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <STC15F2K60S2.H>
   2          #include "iic.h"
   3          #define u8 unsigned char
   4          #define u16 unsigned int
   5          u8 code LED[] = {0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90,0xbf,0xff};
   6          u8 yi,er,san,si,wu,liu,qi,ba;
   7          u8 shidu,chushui=0,cnt=0;
   8          u16 num=0;
   9          void delay_ms(u16 ms)
  10          {
  11   1        u16 i,j;
  12   1        for(i=ms;i>0;i--)
  13   1          for(j=845;j>0;j--);
  14   1      }
  15          void INIT()
  16          {
  17   1        P2=0XA0;
  18   1        P0=0X00;
  19   1        
  20   1        P2=0X80;
  21   1        P0=0XFF;
  22   1        
  23   1        P2=0XC0;
  24   1        P0=0XFF;
  25   1        P2=0XFF;
  26   1        P0=0XFF;
  27   1      }
  28          void KEY_BTN()
  29          {
  30   1        if(P30==0)
  31   1        {
  32   2          delay_ms(5);
  33   2          if(P30==0)
  34   2          {
  35   3            if(chushui==0)
  36   3            {
  37   4              num = 0;
  38   4              P2=0XA0;
  39   4              P0=0X10;
  40   4              chushui=1;
  41   4              ET0=1;
  42   4              EA=1;
  43   4            }
  44   3          }
  45   2          while(!P30);
  46   2        }
  47   1        else if(P31==0)
  48   1        {
  49   2          delay_ms(5);
  50   2          if(P31==0){
  51   3            if(chushui)
  52   3            {
  53   4              num*=0.5;
  54   4              ba=num%10;
C51 COMPILER V9.55   MAIN                                                                  03/24/2020 10:52:32 PAGE 2   

  55   4              qi=num%100/10;
  56   4              liu=num%1000/100;
  57   4              wu=num/1000;
  58   4              //num=0;
  59   4              P2=0XA0;
  60   4              P0=0X00;
  61   4              ET0=0;
  62   4              EA=0;
  63   4              chushui=0;
  64   4            }
  65   3            
  66   3          }
  67   2          while(!P31);
  68   2        }
  69   1      }
  70          void display()
  71          {
  72   1      
  73   1        P2=0xc0;
  74   1        P0=0X01;
  75   1        P2=0XFF;
  76   1        P0=LED[yi];
  77   1        delay_ms(1);
  78   1        
  79   1        P2=0xc0;
  80   1        P0=0X02;
  81   1        P2=0XFF;
  82   1        P0=LED[er]&0X7F;
  83   1        delay_ms(1);
  84   1        
  85   1        P2=0xc0;
  86   1        P0=0X04;
  87   1        P2=0XFF;
  88   1        P0=LED[san];
  89   1        delay_ms(1);
  90   1        
  91   1        P2=0xc0;
  92   1        P0=0X08;
  93   1        P2=0XFF;
  94   1        P0=LED[si];
  95   1        delay_ms(1);
  96   1        
  97   1        P2=0xc0;
  98   1        P0=0X10;
  99   1        P2=0XFF;
 100   1        P0=LED[wu];
 101   1        delay_ms(1);
 102   1        
 103   1        P2=0xc0;
 104   1        P0=0X20;
 105   1        P2=0XFF;
 106   1        P0=LED[liu]&0X7F;
 107   1        delay_ms(1);
 108   1        
 109   1        P2=0xc0;
 110   1        P0=0X40;
 111   1        P2=0XFF;
 112   1        P0=LED[qi];
 113   1        delay_ms(1);
 114   1        
 115   1        P2=0xc0;
 116   1        P0=0X80;
C51 COMPILER V9.55   MAIN                                                                  03/24/2020 10:52:32 PAGE 3   

 117   1        P2=0XFF;
 118   1        P0=LED[ba];
 119   1        delay_ms(1);
 120   1        
 121   1      }
 122          void Timer0Init(void)   //1毫秒@11.0592MHz
 123          {
 124   1        AUXR |= 0x80;   //定时器时钟1T模式
 125   1        TMOD &= 0xF0;   //设置定时器模式
 126   1        TL0 = 0xCD;   //设置定时初值
 127   1        TH0 = 0xD4;   //设置定时初值
 128   1        TF0 = 0;    //清除TF0标志
 129   1        TR0 = 1;    //定时器0开始计时
 130   1      }
 131          
 132          void timer0(void)interrupt 1
 133          {
 134   1        if(++cnt>99)
 135   1        {
 136   2          cnt=0;
 137   2          num++;
 138   2          ba=num%10;
 139   2          qi=num%100/10;
 140   2          liu=num%1000/100;
 141   2          wu=num/1000;
 142   2          if(num==9999)
 143   2          {
 144   3              num*=0.5;
 145   3              ba=num%10;
 146   3              qi=num%100/10;
 147   3              liu=num%1000/100;
 148   3              wu=num/1000;
 149   3              //num=0;
 150   3              P2=0XA0;
 151   3              P0=0X00;
 152   3              ET0=0;
 153   3              EA=0;
 154   3              chushui=0;
 155   3          }
 156   2        }
 157   1      }
 158          void main()
 159          {
 160   1        yi=11;er=0;san=5;si=0;wu=0;liu=1;qi=0;ba=0;
 161   1        INIT();
 162   1        Timer0Init();
 163   1        while(1)
 164   1        {
 165   2            KEY_BTN();
 166   2            display();
 167   2            shidu = Read_PCF8591();
 168   2            if(shidu > 64)
 169   2            {
 170   3              P2=0X80;
 171   3              P0=0XfF;
 172   3            }
 173   2            else
 174   2            {
 175   3              P2=0X80;
 176   3              P0=0Xfe;
 177   3            }
 178   2        }
C51 COMPILER V9.55   MAIN                                                                  03/24/2020 10:52:32 PAGE 4   

 179   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    721    ----
   CONSTANT SIZE    =     12    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     13    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
